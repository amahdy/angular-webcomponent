
<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-a11y-keys/iron-a11y-keys.html">

<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-button.html">
<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-text-field.html">
<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-text-area.html">
<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-form-layout.html">
<link rel="import" href="../../bower_components/vaadin-icons/vaadin-icons.html">
<link rel="import" href="../../bower_components/vaadin-form-layout/vaadin-form-layout.html">

<link rel="import" href="../../bower_components/vaadin-button/vaadin-button.html">
<link rel="import" href="../../bower_components/vaadin-text-field/vaadin-text-field.html">
<link rel="import" href="../../bower_components/vaadin-text-field/vaadin-text-area.html">

<dom-module id="person-editor">
  <template>
    <style>
      :host {
        display: block;
      }

      /* expected to be fixed in vaadin-button 1.0.5 */
      vaadin-button[hidden] {
        display: none;
      }
    </style>

    <vaadin-form-layout class="with-text-fields">
      <vaadin-text-field placeholder="First Name" id="firstName"></vaadin-text-field>
      <vaadin-text-field placeholder="Last Name" id="lastName"></vaadin-text-field>
      <vaadin-text-field placeholder="Phone" id="phone"></vaadin-text-field>
      <vaadin-text-field placeholder="E-Mail" id="email"></vaadin-text-field>
      <vaadin-text-area placeholder="Address" id="address"></vaadin-text-area>
    </vaadin-form-layout>

    <vaadin-button on-tap="update">
      <template is="dom-if" if="[[isUpdate]]">
        Update
      </template>
      <template is="dom-if" if="[[!isUpdate]]">
        Create
      </template>
    </vaadin-button>
    <vaadin-button hidden$="[[!isUpdate]]" theme="error" on-tap="delete">
      Delete
    </vaadin-button>

    <iron-a11y-keys keys="enter" on-keys-pressed="update"></iron-a11y-keys>
  </template>

  <script>
    Polymer({

      is: 'person-editor',

      properties: {
        person: {
          type: Object,
          value: {}
        },

        isUpdate: {
          type: Boolean,
          value: false
        },
      },

      updatePerson: function(newPerson, isManual) {

        // Only focus when editing or manually adding.
        // Don't focus on first load of the page.
        // Don't focus after de-selection.
        if(newPerson || isManual) {
          this.$.firstName.focus();
        }

        if(newPerson) {
          this.person = newPerson;
          if(!this.person.address) {
            // TODO: find better fix in case of empty object?
            this.person.address = {};
          }
          this.$.firstName.value = this.person.firstName;
          this.$.lastName.value = this.person.lastName;
          this.$.phone.value = this.person.address.phone;
          this.$.email.value = this.person.email;
          this.$.address.value = this.person.address.street;
          this.isUpdate = true;
        }else {
          this.person = {};
          this.person.address = {};
          this.$.firstName.value = '';
          this.$.lastName.value = '';
          this.$.phone.value = '';
          this.$.email.value = '';
          this.$.address.value = '';
          this.isUpdate = false;
        }
      },

      update: function() {
        this.person.firstName = this.$.firstName.value;
        this.person.lastName = this.$.lastName.value;
        this.person.address.phone = this.$.phone.value;
        this.person.email = this.$.email.value;
        this.person.address.street = this.$.address.value;

        if(!this.isUpdate) {
          this.fire('on-create', {newPerson: this.person});
        }else {
          this.fire('on-update', {newPerson: this.person});
        }
      },

    });
  </script>
</dom-module>
