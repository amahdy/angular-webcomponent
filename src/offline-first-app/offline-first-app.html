
<script src="../../bower_components/pouchdb/dist/pouchdb.min.js"></script>
<script src="../../bower_components/pouchdb-find/dist/pouchdb.find.min.js"></script>

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/vaadin-split-layout/vaadin-split-layout.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="./offline-grid.html">
<link rel="import" href="./person-editor.html">
<link rel="import" href="./person-search.html">

<dom-module id="offline-first-app">
  <template>
    <style>
      :host {
        display: block;
      }

      #topLayout {
        height: 100%;
      }

      #offlineGrid {
        height: 100%;
      }

      #gridArea {
        width: 75%;
        height: 100%;
      }

      #editor {
        width: 25%;
        height: 100%;
        margin: 8px;
        position: relative;
      }

      #search {
        margin: 8px;
      }

      paper-fab.add-button {
        margin-top: 12px;
        margin-right: 0px;
        float: right;
        background-color: #00b4f0;
        color: white;
        position: fixed;
        right: 27%;
        bottom: 30px;
      }
    </style>

    <vaadin-split-layout id="topLayout">
      <div id="gridArea">
        <person-search id="search"></person-search>
        <offline-grid id="offlineGrid"></offline-grid>
        <paper-fab class="add-button" on-tap="add" icon="add"></paper-fab>
      </div>

      <person-editor id="editor" person$="{{selected}}"></person-editor>

    </vaadin-split-layout>
  </template>

  <script>
    Polymer({

      is: 'offline-first-app',

      ready: function() {
        this.$.offlineGrid.addEventListener('on-select', evt => {
          // TODO: Grid looses focus so need to refresh selection
          this.$.editor.person = evt.detail.selected;
        });

        this.$.editor.addEventListener('on-update', evt => {
          this.$.offlineGrid.update(evt.detail.newPerson);
        });

        this.$.editor.addEventListener('on-create', evt => {
          this.$.offlineGrid.create(evt.detail.newPerson);
        });

        this.$.search.addEventListener('on-find', evt => {
          this.$.offlineGrid.search(evt.detail.value);
        });
      },

      add: function() {
        this.$.editor.person = {};
      },

    });
  </script>
</dom-module>
